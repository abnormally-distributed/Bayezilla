

model {
  for ( i in 1:N ) {
    y[i,1:P] ~ dmnorm(mu[1:P] , Tau[1:P,1:P]) 
  }
  for ( varIdx in 1:P ) {
    mu[varIdx] ~ dnorm( 0 , 1e-200) 
  }
  
  # Estimate precision matrix
  Tau ~ dwish(priorScale[1:P, 1:P], df)
  
  # Convert precision matrix to correlation:
  Sigma <- inverse(Tau)
  
  for ( varIdx in 1:P ) { 
    sqrtSigma[varIdx] <- sqrt(Sigma[varIdx,varIdx]) 
    }
  for ( varIdx1 in 1:P ) { 
    for ( varIdx2 in 1:P-1 ) {
    Rho[varIdx1,varIdx2+1] <- ( Sigma[varIdx1,varIdx2] 
                               / (sqrtSigma[varIdx1]*sqrtSigma[varIdx2]) )
    }
  }
  
  # Convert precision matrix to partial correlation:
  for ( varIdx in 1:P ) { 
    sqrtinvTau[varIdx] <- sqrt(Tau[varIdx,varIdx]) 
  }
  
  for ( varIdx1 in 1:P ) { 
    for ( varIdx2 in 1:P ) {
    parRho[varIdx1,varIdx2] <-  -1 *  ( Tau[varIdx1,varIdx2] 
                               / (sqrtinvTau[varIdx1]*sqrtinvTau[varIdx2]))
    }
  }
}
